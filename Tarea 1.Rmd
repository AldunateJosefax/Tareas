---
#title: "Tarea 1 Josefa Aldunate"
#output: html_document
#date: "2025-10-21"
---
#Cargar librerías necesarias

install.packages("tidyverse")

install.packages("readxl")

install.packages("showtext")

install.packages("sysfonts")

install.packages("dplyr")

library(showtext)

library(sysfonts)

library(tidyverse)

library(readxl)

library(dplyr)

library(ggplot2)

#Cargar datos, para ello, se deberá cargar la API de spotify

install.packages('spotifyr')
library(spotifyr)

#Ingresar credenciales de Spotify

Sys.setenv(SPOTIFY_CLIENT_ID = '347570626c4e4a16b776c37845b6cb9a')
Sys.setenv(SPOTIFY_CLIENT_SECRET = '0f9391626dd845f0be16743f10a3461d')

access_token <- get_spotify_access_token()

#Verificar el acceso a API

access_token

#Buscar Sabrina Carpenter en Spotify y obtener su ID de artista

sabrina <- search_spotify("Sabrina Carpenter", type = "artist")
sabrina$id

#Obtener los álbumes de Sabrina Carpenter

sabrina_albums <- get_artist_albums(sabrina$id[1], include_groups = "album")
unique(sabrina_albums$name)

View(sabrina_albums)

#Limpiar base de sabrina_albums, para dejar solo las columnas de interés y renombrarlas (es importante mantener en la columna el id, ya que es la manera de identificar en la base de datos de spotify lo que estamos solicitando)

sabrina_albums <- sabrina_albums %>%
  select(id, name, release_date, total_tracks) %>%
  distinct(name, .keep_all = TRUE) %>%
  rename(
    nombre = name,
    `fecha de lanzamiento` = release_date,
    canciones = total_tracks
  )

View(sabrina_albums)

#Utilizaremos las funciones del paquete de dplyr para manipular los datos, ya que buscaremos conocer la popularidad de sus álbumes

album_popularity <- sabrina_albums %>%
  rowwise() %>%
  mutate(
    popularidad = {
      tracks_data <- get_album_tracks(id)
      track_ids <- tracks_data$id
      track_info <- get_tracks(track_ids)
      mean(track_info$popularity, na.rm = TRUE)
    }
  ) %>%
  ungroup() %>%
  select(nombre, `fecha de lanzamiento`, canciones, popularidad) %>%
  arrange(desc(popularidad))

View(album_popularity)

#La popularidad en spotify es basada del 0 al 100, siendo 100 la más popular
#Para poder visualizar/modelar los álbumes de acuerdo a su popularidad 

# Activar fuente decorativa (opcional)

font_add_google("Pacifico", "pacifico")

showtext_auto()

# Ordenamos de mayor a menor popularidad

sabrina_plot <- album_popularity %>%
  arrange(desc(popularidad)) %>%
  mutate(nombre = factor(nombre, levels = rev(unique(nombre))))



ggplot(sabrina_plot, aes(x = popularidad, y = nombre)) +
  geom_bar(stat = "identity", fill = "#6ECFF6", alpha = 0.9, color = "white", linewidth = 1.2) +
  geom_bar(stat = "identity", fill = "skyblue", alpha = 0.4) +  # capa extra para efecto "brillo"
  geom_text(aes(label = nombre), hjust = -0.1, color = "white",
            fontface = "bold", family = "pacifico", size = 6) +
  labs(
    title = "Popularidad de los álbumes de Sabrina Carpenter 💿",
    subtitle = "Basado en la media de popularidad de sus canciones",
    x = "Popularidad promedio",
    y = NULL
  ) +
  theme_minimal(base_family = "pacifico") +
  theme(
    plot.title = element_text(size = 20, color = "#0099CC", hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = "gray40", hjust = 0.5),
    axis.text.y = element_blank(),
    axis.text.x = element_text(size = 12, color = "gray30"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.background = element_rect(fill = "white", color = NA)
  ) +
  coord_cartesian(xlim = c(0, max(sabrina_plot$popularidad) * 1.2)) +
  coord_flip()


# Gráfico horizontal

ggplot(sabrina_plot, aes(x = nombre, y = popularidad)) +
  geom_bar(stat = "identity", fill = "#6ECFF6", alpha = 0.9, color = "white", linewidth = 1.2) +
  geom_bar(stat = "identity", fill = "skyblue", alpha = 0.4) +  # efecto brillo
  geom_text(aes(label = round(popularidad, 1)), 
            hjust = -0.2, color = "white", fontface = "bold", 
            family = "pacifico", size = 6) +
  labs(
    title = "Popularidad de los álbumes de Sabrina Carpenter 💿",
    subtitle = "Basado en la media de popularidad de sus canciones",
    x = NULL,
    y = "Popularidad promedio"
  ) +
  theme_minimal(base_family = "pacifico") +
  theme(
    plot.title = element_text(size = 18, color = "#0099CC", hjust = 1),
    plot.subtitle = element_text(size = 12, color = "gray40", hjust = 4),
    axis.text.y = element_text(size = 12, color = "gray30", hjust = 1),
    axis.text.x = element_blank(),
    axis.title.y = element_text(size = 14, face = "bold", color = "black"),
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    plot.background = element_rect(fill = "white", color = NA)
  ) +
  coord_flip(clip = "off") + 
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  expand_limits(y = max(sabrina_plot$popularidad) * 1.15)


